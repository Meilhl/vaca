<?php session_start();
if(isset($_SESSION['destroy'])){unset($_SESSION['destroy']);header('Location:Accueil_administrateur.php');}
?>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <link rel="stylesheet" type="text/css" href="../../Style/Style.css" media="all" />


    <title>
		Ajout exploitation
	</title>
</head>
    <div class= "header">
    <?php
    $role=1;
    require("../../Style/Entete.php");
    affiche_entete($role);
    ?>
    </div>

<div class="corps" style="background-color: rgba(159,185,153,0);">
  <center>
    <div class="border" style ="width:35% ; margin:10px;padding:20px;overflow:auto;height:auto">
      <?php
        include ("../../Fonction/creerListeHTMLjava.php") ;

        $link = mysqli_connect('localhost', 'root', '', 'vaca');
        mysqli_set_charset($link,"utf8mb4_general_ci");

        //Ouverture BDD
        mysqli_select_db ($link , "vaca") or die ("impossible d'ouvrir la BDD Vaca : ". mysqli_error($link));

        echo "<h2 style='line-height:1.5em;width:auto;padding:5px;background:none;color:black'> üöú Ajout d'une nouvelle exploitation </h3>";

        // Informations
          // Titre
          echo "<hr><h2 style='font-size:1.3em;width:auto;padding:5px;background:none;color:black;text-align:left'>Remplir les informations suivantes :</h2>";
          echo "<form style='text-align:left'>";
          // Nom
          echo"<br><br> <label for='nom_exploit' style='font-size:1em;font-family:Verdana;font-weight: bold;'>Nom de l'exploitation :</label>";
          if(isset($_GET["nom_exploit"])){
            echo "<center><input type='text' id='nom_exploit' name='nom_exploit' value = '".$_GET['nom_exploit']."'></center>";
          }
          else{echo "<center><input type='text' id='nom_exploit' name='nom_exploit'></center>";}

          // Coordonn√©es
          echo "<br><br><label for='coordX' style='font-size:1em;font-family:Verdana;font-weight: bold;'> Coordonn√©es Longitude X :</label>";
          if(isset($_GET["coordX"])){
            echo "<center><input type='text' id='coordX' name='coordX' value='".$_GET['coordX']."'></center>";
          }
          else{echo "<center><input type='text' id='coordX' name='coordX'></center>";}

          echo "<br><br><label for='coordY' style='font-size:1em;font-family:Verdana;font-weight: bold;'> Coordonn√©es Latitude Y :</label>";
          if(isset($_GET["coordY"])){
            echo "<center><input type='text' id='coordY' name='coordY' value='".$_GET['coordY']."'></center>";
          }
          else{echo "<center><input type='text' id='coordY' name='coordY'></center>";}

          // Adresse
          echo "<br><br><label for='adresse' style='font-size:1em;font-family:Verdana;font-weight: bold;'> Adresse :</label>";
          if(isset($_GET["adresse"])){
            echo "<center><input type='text' id='adresse' name='adresse' value='".$_GET['adresse']."'></center><br>";
          }
          else{echo "<center><input type='text' id='adresse' name='adresse'></center><br>";}

          // Suppl√©ments adresse
          echo "<br><label for='supplement_adresse' style='font-size:1em;font-family:Verdana;font-weight: bold;'> Suppl√©ments d'adresse :</label>";
          if(isset($_GET["supplement_adresse"])){
            echo "<center><input type='text' id='supplement_adresse' name='adresse' value='".$_GET['supplement_adresse']."'></center><br>";
          }
          else{echo "<center><input type='text' id='supplement_adresse' name='supplement_adresse'></center><br>";}

          // Commune
          echo "<hr><h2 style='font-size:1.3em;width:auto;padding:5px;background:none;color:black;text-align:left'>Commune de l'exploitation :</h2>";
          $query_commune = "SELECT DISTINCT id_commune, commune, code_postal
          FROM commune";
          $result_commune = mysqli_query($link, $query_commune)
            or die ("impossible requ√™te" .mysqli_error($link));
          $tab_commune = mysqli_fetch_all($result_commune);


          $nom_liste_commune = "ListeCommune" ;
          echo"<center>";
          $liste_commune = creerListeHTML($nom_liste_commune, $tab_commune);
          echo"</center>";
          echo "<br><center><input type='submit' name='bouton1' value='Ajouter'></center>" ;
          echo "</form>" ;
          echo "<a href=Ajouter_commune.php>Ajouter une commune</a>";


            if(isset($_GET["bouton1"])) {

              //les valeurs √† mettre dans la base de donn√©es pour la cr√©ation d'une demande de mat√©riel
              $id_commune=$_GET["ListeCommune"];
              $nom_exploit= $_GET["nom_exploit"];
              $coordX=$_GET["coordX"];
              $coordY= $_GET["coordY"];
              $adresse=$_GET["adresse"];
              $supplement_adresse=$_GET["supplement_adresse"];

              //query pour ins√©rer la demande
              $ajout_exploit= " INSERT INTO exploitation (id_commune, nom_exploit, coordX, coordY, adresse, supplement_adresse)
              VALUES (\"".$id_commune."\",\"".$nom_exploit."\",\"".$coordX."\",\"".$coordY."\",\"".$adresse."\",\"".$supplement_adresse."\")" ;



              if(mysqli_query($link,$ajout_exploit)){
                // Pour √©viter les r√©actualisations intempestives
                $_SESSION["destroy"]=TRUE;
                echo "<dialogue>Ajout r√©ussi !<br>
                <h2 style='line-height:1.5em;width:auto;padding:5px;background:none;color:black;'> Retour au menu <a href='Accueil_administrateur.php' style='font-size=1em'>üè†</a></h2>
                <h2 style='line-height:1.5em;width:auto;padding:5px;background:none;color:black;'> Lier l'exploitation √† un √©leveur <a href='attribution_exploit_profil.php' style='font-size=1em'>üßë‚Äçüåæ</a></h2>
                </dialogue>";
              }
              else{
                echo "<div class='alert'>
                        <span class='closebtn' onclick='this.parentElement.style.display=\"none\";'>&times;</span>
                          <strong>Bizarre</strong> quelque chose n'a pas fonctionn√©, veuillez r√©essayer (sans oublier de remplir tous les champs) ou contacter le Conservatoire si le probl√®me persiste... Ah bah non...
                      </div>";
              }
            }
            ?>

    </div>
  </center>

</div>
    <div class="footer">
    <?php include("../../Style/Pied.html"); ?>
  </div>

</hmtl>
